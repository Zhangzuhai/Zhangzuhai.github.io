<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  

  
  <title>zzuhai</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="zzuhai">
<meta property="og:url" content="http://zzuhai.github.io/index.html">
<meta property="og:site_name" content="zzuhai">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="zzuhai">
  
    <link rel="alternate" href="/atom.xml" title="zzuhai" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">zzuhai</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://zzuhai.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-熔断器Hystrix配置及使用" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/06/04/熔断器Hystrix配置及使用/" class="article-date">
  <time datetime="2019-06-04T09:08:51.000Z" itemprop="datePublished">2019-06-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/06/04/熔断器Hystrix配置及使用/">熔断器Hystrix配置及使用</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="1、背景"><a href="#1、背景" class="headerlink" title="1、背景"></a>1、背景</h4><p>调用链路：A》B》C，如果C不可用，将影响B，进而影响A，形成雪崩效应。</p>
<h4 id="2、熔断机制"><a href="#2、熔断机制" class="headerlink" title="2、熔断机制"></a>2、熔断机制</h4><p>Hystrix Command请求后端服务失败数量超过一定比例(默认50%)且10秒内超过20个请求, 断路器会切换到开路状态(Open). 这时所有请求会直接失败而不会发送到后端服务. 断路器保持在开路状态一段时间后(默认5秒，每隔5s允许一个请求通过), 自动切换到半开路状态(HALF-OPEN). 这时会判断下一次请求的返回情况, 如果请求成功（请求都是健康的（RT&lt;250ms））, 断路器切回闭路状态(CLOSED), 否则重新切换到开路状态(OPEN). Hystrix的断路器就像我们家庭电路中的保险丝, 一旦后端服务不可用, 断路器会直接切断请求链, 避免发送大量无效请求影响系统吞吐量, 并且断路器有自我检测并恢复的能力.<br>熔断针对方法级别，A服务调用B服务的B1接口熔断，此时A服务依旧能调用B服务的B2接口。虽不直接影响调用B2接口，但由于熔断被触发，必然请求频率及错误比例会较高，这将导致单实例性能受到影响，从而间接影响A服务调用B服务的B2接口，表现通常为超时。</p>
<p>Note：测试发现，服务抛出的异常也会引发熔断。<br>HystrixBadRequestException异常将不会触发熔断。</p>
<h6 id="Hystrix如何解决依赖隔离"><a href="#Hystrix如何解决依赖隔离" class="headerlink" title="Hystrix如何解决依赖隔离"></a>Hystrix如何解决依赖隔离</h6><ol>
<li>Hystrix使用命令模式HystrixCommand(Command)包装依赖调用逻辑，每个命令在单独线程中/信号授权下执行。</li>
<li>可配置依赖调用超时时间,超时时间一般设为比99.5%平均时间略高即可.当调用超时时，直接返回或执行fallback逻辑。</li>
<li>为每个依赖提供一个小的线程池（或信号），如果线程池已满调用将被立即拒绝，默认不采用排队，加速失败判定时间。</li>
<li>依赖调用结果分:成功，失败（抛出异常），超时，线程拒绝，短路。 请求失败(异常，拒绝，超时，短路)时执行fallback(降级)逻辑。</li>
<li>提供熔断器组件,可以自动运行或手动调用,停止当前依赖一段时间(10秒)，熔断器默认错误率阈值为50%,超过将自动运行。</li>
<li>提供近实时依赖的统计和监控。</li>
</ol>
<h4 id="3、添加熔断机制"><a href="#3、添加熔断机制" class="headerlink" title="3、添加熔断机制"></a>3、添加熔断机制</h4><p>Note：<br>以demo中提到的SpringCloudConsumer项目为例，该服务将通过SpringCloudProducerFeignClient接口调用SpringCloudProducer服务。</p>
<h5 id="3-1、application-properties配置"><a href="#3-1、application-properties配置" class="headerlink" title="3.1、application.properties配置"></a>3.1、application.properties配置</h5><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#开启熔断机制</span></span><br><span class="line"><span class="string">feign.hystrix.enabled=true</span></span><br><span class="line"><span class="comment"># 设置hystrix超时时间，默认1000ms</span></span><br><span class="line"><span class="string">hystrix.command.default.execution.isolation.thread.timeoutInMilliseconds=60000</span></span><br><span class="line"><span class="comment"># 是否开启超时，默认false，不建议开启</span></span><br><span class="line"><span class="comment"># hystrix.command.default.execution.isolation.thread.interruptOnTimeout=false</span></span><br><span class="line"><span class="comment"># 最大线程数量，默认10，Fast Fail 应用，建议使用默认值。</span></span><br><span class="line"><span class="comment"># hystrix.threadpool.default.coreSize=20</span></span><br><span class="line"><span class="comment"># 允许在队列中的等待的任务数量，默认5，Fast Fail 应用，建议使用默认值。</span></span><br><span class="line"><span class="comment"># hystrix.threadpool.default.queueSizeRejectionThreshold=10</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># queueSizeRejectionThreshold默认值是5，允许在队列中的等待的任务数量。maxQueueSize默认值是-1，队列大小。如果是Fast Fail 应用，建议使用默认值。线程池饱满后直接拒绝后续的任务，不再进行等待。即使maxQueueSize没有达到，达到queueSizeRejectionThreshold该值后，请求也会被拒绝。</span></span><br></pre></td></tr></table></figure>

<h5 id="3-2、创建熔断回调类"><a href="#3-2、创建熔断回调类" class="headerlink" title="3.2、创建熔断回调类"></a>3.2、创建熔断回调类</h5><p>在feignClient同级目录创建目录fallback，在hystrix目录新建回调类。回调类分为含异常信息的回调类（以FallbackFactory为后缀），以及不含异常信息的回调类（以Fallback为后缀），二选一即可。</p>
<h6 id="3-2-1、创建含异常信息的回调类"><a href="#3-2-1、创建含异常信息的回调类" class="headerlink" title="3.2.1、创建含异常信息的回调类"></a>3.2.1、创建含异常信息的回调类</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringCloudProducerFallbackFactory</span> <span class="keyword">implements</span> <span class="title">FallbackFactory</span>&lt;<span class="title">SpringCloudProducerFeignClient</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 可获取熔断异常，重写接口中的各个方法分别返回带异常信息的熔断信息.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> cause 异常信息(可用于记录日志)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> FeignClient</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SpringCloudProducerFeignClient <span class="title">create</span><span class="params">(Throwable cause)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SpringCloudProducerFeignClient() &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">testTrackID</span><span class="params">(String param)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">"testTrackID:"</span> + cause.getMessage();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> RoomRelationBo <span class="title">getRoomRelationByKeyID</span><span class="params">(String KeyID)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="3-2-2、创建不含异常信息的回调类"><a href="#3-2-2、创建不含异常信息的回调类" class="headerlink" title="3.2.2、创建不含异常信息的回调类"></a>3.2.2、创建不含异常信息的回调类</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringCloudProducer2Fallback</span> <span class="keyword">implements</span> <span class="title">SpringCloudProducerFeignClient</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">testTrackID</span><span class="params">(String param)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="string">"[Hystrix]testTrackID"</span>; <span class="comment">// 自定义熔断返回信息</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RoomRelationBo <span class="title">getRoomRelationByKeyID</span><span class="params">(String KeyID)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="3-3、为FeignClient指定fallback或fallbackFactory"><a href="#3-3、为FeignClient指定fallback或fallbackFactory" class="headerlink" title="3.3、为FeignClient指定fallback或fallbackFactory"></a>3.3、为FeignClient指定fallback或fallbackFactory</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//@FeignClient(name = "spring-cloud-producer",fallback= SpringCloudProducerFallback.class)</span></span><br><span class="line"><span class="meta">@FeignClient</span>(name = <span class="string">"spring-cloud-producer"</span>,fallbackFactory= SpringCloudProducerFallbackFactory.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SpringCloudProducerFeignClient</span> </span>&#123;</span><br><span class="line">    <span class="meta">@PostMapping</span>(value = <span class="string">"/api/testTrackID"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">testTrackID</span><span class="params">(@RequestParam(value = <span class="string">"param"</span>)</span> String param)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(value = <span class="string">"/api/getRoomRelationByKeyID"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> RoomRelationBo <span class="title">getRoomRelationByKeyID</span><span class="params">(@RequestParam(<span class="string">"keyID"</span>)</span> String KeyID)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="3-4、依赖配置"><a href="#3-4、依赖配置" class="headerlink" title="3.4、依赖配置"></a>3.4、依赖配置</h5><p>引入依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-hystrix<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>注解：<br>应用主类Application上加上@EnableCircuitBreaker或@EnableHystrix注解开启Hystrix的使用。</p>
<hr>
<h4 id="4、Hystrix配置说明"><a href="#4、Hystrix配置说明" class="headerlink" title="4、Hystrix配置说明"></a>4、Hystrix配置说明</h4><ol>
<li>统计滚动的时间窗口 default 10000 ten seconds<br>withMetricsRollingStatisticalWindowInMilliseconds(10000)</li>
<li>滚动时间窗口 bucket 数量 default<br>withMetricsRollingStatisticalWindowBuckets(10)</li>
<li>采样时间间隔 default 500<br>withMetricsHealthSnapshotIntervalInMilliseconds(1)</li>
<li>熔断器在整个统计时间内是否开启的阀值，默认20。也就是10秒钟内至少请求20次，熔断器才发挥起作用<br>withCircuitBreakerRequestVolumeThreshold(20)</li>
<li>默认:50。当出错率超过50%后熔断器启动.<br>withCircuitBreakerErrorThresholdPercentage(30)</li>
<li>熔断器默认工作时间,默认:5秒.熔断器中断请求5秒后会关闭重试,如果请求仍然失败,继续打开熔断器5秒,如此循环<br>withCircuitBreakerSleepWindowInMilliseconds(1000)</li>
<li>隔离策略<br>withExecutionIsolationStrategy(ExecutionIsolationStrategy.SEMAPHORE)</li>
<li>信号量隔离时最大并发请求数<br>withExecutionIsolationSemaphoreMaxConcurrentRequests(2)</li>
<li>命令组名，该命令属于哪一个组，可以帮助我们更好的组织命令。<br>withGroupKey(HystrixCommandGroupKey.Factory.asKey(“HelloGroup”))</li>
<li>命令名称，每个CommandKey代表一个依赖抽象,相同的依赖要使用相同的CommandKey名称。依赖隔离的根本就是对相同CommandKey的依赖做隔离。<br>andCommandKey(HystrixCommandKey.Factory.asKey(“Hello”)</li>
<li>所属线程池的名称，同样配置的命令会共享同一线程池，若不配置，会默认使用GroupKey作为线程池名称。<br>andThreadPoolKey(HystrixThreadPoolKey.Factory.asKey(“HelloThreadPool”))  </li>
<li>命令属性，设置包括断路器的配置，隔离策略，降级设置，以及一些监控指标等。</li>
<li>线程池属性，配置包括线程池大小，排队队列的大小等。</li>
</ol>
<p>hystrix.command.default.execution.isolation.thread.timeoutInMilliseconds=1000<br>超时时间，默认1000ms<br>execution.timeout.enabled<br>是否开启超时，默认true<br>execution.isolation.thread.interruptOnTimeout<br>当超时的时候是否中断(interrupt) HystrixCommand.run()执行</p>
<p>配置说明官方文档：<a href="https://github.com/Netflix/Hystrix/wiki/Configuration" target="_blank" rel="noopener">https://github.com/Netflix/Hystrix/wiki/Configuration</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://zzuhai.github.io/2019/06/04/熔断器Hystrix配置及使用/" data-id="cjwhlc95x001fawuvuhjfinxp" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/spring-cloud/">spring cloud</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-堆" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/06/04/堆/" class="article-date">
  <time datetime="2019-06-04T08:48:17.000Z" itemprop="datePublished">2019-06-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/06/04/堆/">堆</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h4><p>堆是由数组实现的树<br>和二叉树不同的是堆没有父节点和子节点的指针<br>数组存放的只是值</p>
<p>分为最大堆和最小堆：<br>最大堆：所有父节点都大于他的子节点<br>最小堆：所有父节点都小于他的子节点</p>
<p>堆的每一层都必须排满了才能接着排下一层</p>
<h4 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h4><p>待完成</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://zzuhai.github.io/2019/06/04/堆/" data-id="cjwhlc95s0015awuvel84ixc8" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/数据结构/">数据结构</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-红黑树" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/06/04/红黑树/" class="article-date">
  <time datetime="2019-06-04T08:42:20.000Z" itemprop="datePublished">2019-06-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/06/04/红黑树/">红黑树</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h5 id="红黑树的定义"><a href="#红黑树的定义" class="headerlink" title="红黑树的定义"></a>红黑树的定义</h5><p>红黑树是一种近似平衡的二叉查找树，它能够确保任何一个节点的左右子树的高度差不会超过二者中较低那个的一倍</p>
<h5 id="必须要满足的条件"><a href="#必须要满足的条件" class="headerlink" title="必须要满足的条件"></a>必须要满足的条件</h5><ol>
<li>每个节点要么是红色，要么是黑色。</li>
<li>根节点必须是黑色</li>
<li>红色节点不能连续（也即是，红色节点的孩子和父亲都不能是红色）。</li>
<li>对于每个节点，从该点至null（树尾端）的任何路径，都含有相同个数的黑色节点。</li>
</ol>
<h5 id="左旋红黑树的代码"><a href="#左旋红黑树的代码" class="headerlink" title="左旋红黑树的代码"></a>左旋红黑树的代码</h5><p><img src="https://images2015.cnblogs.com/blog/939998/201605/939998-20160517212009529-1958413310.png" alt="image"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">rotateLeft</span><span class="params">(Entry&lt;K,V&gt; p)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (p != <span class="keyword">null</span>) &#123;</span><br><span class="line">        Entry&lt;K,V&gt; r = p.right;</span><br><span class="line">        p.right = r.left;</span><br><span class="line">        <span class="keyword">if</span> (r.left != <span class="keyword">null</span>)</span><br><span class="line">            r.left.parent = p;</span><br><span class="line">        r.parent = p.parent;</span><br><span class="line">        <span class="keyword">if</span> (p.parent == <span class="keyword">null</span>)</span><br><span class="line">            root = r;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (p.parent.left == p)</span><br><span class="line">            p.parent.left = r;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            p.parent.right = r;</span><br><span class="line">        r.left = p;</span><br><span class="line">        p.parent = r;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="右旋红黑树的代码"><a href="#右旋红黑树的代码" class="headerlink" title="右旋红黑树的代码"></a>右旋红黑树的代码</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">rotateRight</span><span class="params">(Entry&lt;K,V&gt; p)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (p != <span class="keyword">null</span>) &#123;</span><br><span class="line">        Entry&lt;K,V&gt; l = p.left;</span><br><span class="line">        p.left = l.right;</span><br><span class="line">        <span class="keyword">if</span> (l.right != <span class="keyword">null</span>) l.right.parent = p;</span><br><span class="line">        l.parent = p.parent;</span><br><span class="line">        <span class="keyword">if</span> (p.parent == <span class="keyword">null</span>)</span><br><span class="line">            root = l;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (p.parent.right == p)</span><br><span class="line">            p.parent.right = l;</span><br><span class="line">        <span class="keyword">else</span> p.parent.left = l;</span><br><span class="line">        l.right = p;</span><br><span class="line">        p.parent = l;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="红黑树的get（key）方法"><a href="#红黑树的get（key）方法" class="headerlink" title="红黑树的get（key）方法"></a>红黑树的get（key）方法</h5><p><img src="https://images2015.cnblogs.com/blog/939998/201605/939998-20160517211944357-1810109113.png" alt="image"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> Entry&lt;K,V&gt; <span class="title">getEntry</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">    ......</span><br><span class="line">    <span class="keyword">if</span> (key == <span class="keyword">null</span>)<span class="comment">//不允许key值为null</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">    Comparable&lt;? <span class="keyword">super</span> K&gt; k = (Comparable&lt;? <span class="keyword">super</span> K&gt;) key;<span class="comment">//使用元素的自然顺序</span></span><br><span class="line">    Entry&lt;K,V&gt; p = root;</span><br><span class="line">    <span class="keyword">while</span> (p != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">int</span> cmp = k.compareTo(p.key);</span><br><span class="line">        <span class="keyword">if</span> (cmp &lt; <span class="number">0</span>)<span class="comment">//向左找</span></span><br><span class="line">            p = p.left;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (cmp &gt; <span class="number">0</span>)<span class="comment">//向右找</span></span><br><span class="line">            p = p.right;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> p;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="红黑树的put（）方法"><a href="#红黑树的put（）方法" class="headerlink" title="红黑树的put（）方法"></a>红黑树的put（）方法</h5><p><img src="https://images2015.cnblogs.com/blog/939998/201605/939998-20160517212000341-1761362961.png" alt="image"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">    ......</span><br><span class="line">    <span class="keyword">int</span> cmp;</span><br><span class="line">    Entry&lt;K,V&gt; parent;</span><br><span class="line">    <span class="keyword">if</span> (key == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">    Comparable&lt;? <span class="keyword">super</span> K&gt; k = (Comparable&lt;? <span class="keyword">super</span> K&gt;) key;<span class="comment">//使用元素的自然顺序</span></span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        parent = t;</span><br><span class="line">        cmp = k.compareTo(t.key);</span><br><span class="line">        <span class="keyword">if</span> (cmp &lt; <span class="number">0</span>) t = t.left;<span class="comment">//向左找</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (cmp &gt; <span class="number">0</span>) t = t.right;<span class="comment">//向右找</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> t.setValue(value);</span><br><span class="line">    &#125; <span class="keyword">while</span> (t != <span class="keyword">null</span>);</span><br><span class="line">    Entry&lt;K,V&gt; e = <span class="keyword">new</span> Entry&lt;&gt;(key, value, parent);<span class="comment">//创建并插入新的entry</span></span><br><span class="line">    <span class="keyword">if</span> (cmp &lt; <span class="number">0</span>) parent.left = e;</span><br><span class="line">    <span class="keyword">else</span> parent.right = e;</span><br><span class="line">    fixAfterInsertion(e);<span class="comment">//调整</span></span><br><span class="line">    size++;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="调整红黑树"><a href="#调整红黑树" class="headerlink" title="调整红黑树"></a>调整红黑树</h5><h6 id="图解"><a href="#图解" class="headerlink" title="图解"></a>图解</h6><p><img src="https://images2015.cnblogs.com/blog/939998/201605/939998-20160517212000341-1761362961.png" alt="image"></p>
<h6 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">fixAfterInsertion</span><span class="params">(Entry&lt;K,V&gt; x)</span> </span>&#123;</span><br><span class="line">    x.color = RED;</span><br><span class="line">    <span class="keyword">while</span> (x != <span class="keyword">null</span> &amp;&amp; x != root &amp;&amp; x.parent.color == RED) &#123;</span><br><span class="line">        <span class="keyword">if</span> (parentOf(x) == leftOf(parentOf(parentOf(x)))) &#123;</span><br><span class="line">            Entry&lt;K,V&gt; y = rightOf(parentOf(parentOf(x)));</span><br><span class="line">            <span class="keyword">if</span> (colorOf(y) == RED) &#123;<span class="comment">//如果y为null，则视为BLACK</span></span><br><span class="line">                setColor(parentOf(x), BLACK);              <span class="comment">// 情况1</span></span><br><span class="line">                setColor(y, BLACK);                        <span class="comment">// 情况1</span></span><br><span class="line">                setColor(parentOf(parentOf(x)), RED);      <span class="comment">// 情况1</span></span><br><span class="line">                x = parentOf(parentOf(x));                 <span class="comment">// 情况1</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (x == rightOf(parentOf(x))) &#123;</span><br><span class="line">                    x = parentOf(x);                       <span class="comment">// 情况2</span></span><br><span class="line">                    rotateLeft(x);                         <span class="comment">// 情况2</span></span><br><span class="line">                &#125;</span><br><span class="line">                setColor(parentOf(x), BLACK);              <span class="comment">// 情况3</span></span><br><span class="line">                setColor(parentOf(parentOf(x)), RED);      <span class="comment">// 情况3</span></span><br><span class="line">                rotateRight(parentOf(parentOf(x)));        <span class="comment">// 情况3</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Entry&lt;K,V&gt; y = leftOf(parentOf(parentOf(x)));</span><br><span class="line">            <span class="keyword">if</span> (colorOf(y) == RED) &#123;</span><br><span class="line">                setColor(parentOf(x), BLACK);              <span class="comment">// 情况4</span></span><br><span class="line">                setColor(y, BLACK);                        <span class="comment">// 情况4</span></span><br><span class="line">                setColor(parentOf(parentOf(x)), RED);      <span class="comment">// 情况4</span></span><br><span class="line">                x = parentOf(parentOf(x));                 <span class="comment">// 情况4</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (x == leftOf(parentOf(x))) &#123;</span><br><span class="line">                    x = parentOf(x);                       <span class="comment">// 情况5</span></span><br><span class="line">                    rotateRight(x);                        <span class="comment">// 情况5</span></span><br><span class="line">                &#125;</span><br><span class="line">                setColor(parentOf(x), BLACK);              <span class="comment">// 情况6</span></span><br><span class="line">                setColor(parentOf(parentOf(x)), RED);      <span class="comment">// 情况6</span></span><br><span class="line">                rotateLeft(parentOf(parentOf(x)));         <span class="comment">// 情况6</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    root.color = BLACK;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="寻找节点后继"><a href="#寻找节点后继" class="headerlink" title="寻找节点后继"></a>寻找节点后继</h5><p>t的右子树不空，则t的后继是其右子树中最小的那个元素。<br>t的右孩子为空，则t的后继是其第一个向左走的祖先。</p>
<p><img src="https://images2015.cnblogs.com/blog/939998/201605/939998-20160525090153256-1268136762.png" alt="image"></p>
<p>代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> &lt;K,V&gt; TreeMap.<span class="function">Entry&lt;K,V&gt; <span class="title">successor</span><span class="params">(Entry&lt;K,V&gt; t)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (t == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (t.right != <span class="keyword">null</span>) &#123;<span class="comment">// 1. t的右子树不空，则t的后继是其右子树中最小的那个元素</span></span><br><span class="line">        Entry&lt;K,V&gt; p = t.right;</span><br><span class="line">        <span class="keyword">while</span> (p.left != <span class="keyword">null</span>)</span><br><span class="line">            p = p.left;</span><br><span class="line">        <span class="keyword">return</span> p;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;<span class="comment">// 2. t的右孩子为空，则t的后继是其第一个向左走的祖先</span></span><br><span class="line">        Entry&lt;K,V&gt; p = t.parent;</span><br><span class="line">        Entry&lt;K,V&gt; ch = t;</span><br><span class="line">        <span class="keyword">while</span> (p != <span class="keyword">null</span> &amp;&amp; ch == p.right) &#123;</span><br><span class="line">            ch = p;</span><br><span class="line">            p = p.parent;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> p;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="红黑树的remove（）方法"><a href="#红黑树的remove（）方法" class="headerlink" title="红黑树的remove（）方法"></a>红黑树的remove（）方法</h5><p>代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">deleteEntry</span><span class="params">(Entry&lt;K,V&gt; p)</span> </span>&#123;</span><br><span class="line">    modCount++;</span><br><span class="line">    size--;</span><br><span class="line">    <span class="keyword">if</span> (p.left != <span class="keyword">null</span> &amp;&amp; p.right != <span class="keyword">null</span>) &#123;<span class="comment">// 2. 删除点p的左右子树都非空。</span></span><br><span class="line">        Entry&lt;K,V&gt; s = successor(p);<span class="comment">// 后继</span></span><br><span class="line">        p.key = s.key;</span><br><span class="line">        p.value = s.value;</span><br><span class="line">        p = s;</span><br><span class="line">    &#125;</span><br><span class="line">    Entry&lt;K,V&gt; replacement = (p.left != <span class="keyword">null</span> ? p.left : p.right);</span><br><span class="line">    <span class="keyword">if</span> (replacement != <span class="keyword">null</span>) &#123;<span class="comment">// 1. 删除点p只有一棵子树非空。</span></span><br><span class="line">        replacement.parent = p.parent;</span><br><span class="line">        <span class="keyword">if</span> (p.parent == <span class="keyword">null</span>)</span><br><span class="line">            root = replacement;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (p == p.parent.left)</span><br><span class="line">            p.parent.left  = replacement;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            p.parent.right = replacement;</span><br><span class="line">        p.left = p.right = p.parent = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (p.color == BLACK)</span><br><span class="line">            fixAfterDeletion(replacement);<span class="comment">// 调整</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (p.parent == <span class="keyword">null</span>) &#123;</span><br><span class="line">        root = <span class="keyword">null</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; <span class="comment">// 1. 删除点p的左右子树都为空</span></span><br><span class="line">        <span class="keyword">if</span> (p.color == BLACK)</span><br><span class="line">            fixAfterDeletion(p);<span class="comment">// 调整</span></span><br><span class="line">        <span class="keyword">if</span> (p.parent != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (p == p.parent.left)</span><br><span class="line">                p.parent.left = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (p == p.parent.right)</span><br><span class="line">                p.parent.right = <span class="keyword">null</span>;</span><br><span class="line">            p.parent = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="删除后调整红黑树"><a href="#删除后调整红黑树" class="headerlink" title="删除后调整红黑树"></a>删除后调整红黑树</h5><p>图解<img src="https://images2015.cnblogs.com/blog/939998/201605/939998-20160525072940334-1483504480.png" alt="image"></p>
<p>代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">fixAfterDeletion</span><span class="params">(Entry&lt;K,V&gt; x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (x != root &amp;&amp; colorOf(x) == BLACK) &#123;</span><br><span class="line">        <span class="keyword">if</span> (x == leftOf(parentOf(x))) &#123;</span><br><span class="line">            Entry&lt;K,V&gt; sib = rightOf(parentOf(x));</span><br><span class="line">            <span class="keyword">if</span> (colorOf(sib) == RED) &#123;</span><br><span class="line">                setColor(sib, BLACK);                   <span class="comment">// 情况1</span></span><br><span class="line">                setColor(parentOf(x), RED);             <span class="comment">// 情况1</span></span><br><span class="line">                rotateLeft(parentOf(x));                <span class="comment">// 情况1</span></span><br><span class="line">                sib = rightOf(parentOf(x));             <span class="comment">// 情况1</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (colorOf(leftOf(sib))  == BLACK &amp;&amp;</span><br><span class="line">                colorOf(rightOf(sib)) == BLACK) &#123;</span><br><span class="line">                setColor(sib, RED);                     <span class="comment">// 情况2</span></span><br><span class="line">                x = parentOf(x);                        <span class="comment">// 情况2</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (colorOf(rightOf(sib)) == BLACK) &#123;</span><br><span class="line">                    setColor(leftOf(sib), BLACK);       <span class="comment">// 情况3</span></span><br><span class="line">                    setColor(sib, RED);                 <span class="comment">// 情况3</span></span><br><span class="line">                    rotateRight(sib);                   <span class="comment">// 情况3</span></span><br><span class="line">                    sib = rightOf(parentOf(x));         <span class="comment">// 情况3</span></span><br><span class="line">                &#125;</span><br><span class="line">                setColor(sib, colorOf(parentOf(x)));    <span class="comment">// 情况4</span></span><br><span class="line">                setColor(parentOf(x), BLACK);           <span class="comment">// 情况4</span></span><br><span class="line">                setColor(rightOf(sib), BLACK);          <span class="comment">// 情况4</span></span><br><span class="line">                rotateLeft(parentOf(x));                <span class="comment">// 情况4</span></span><br><span class="line">                x = root;                               <span class="comment">// 情况4</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">// 跟前四种情况对称</span></span><br><span class="line">            Entry&lt;K,V&gt; sib = leftOf(parentOf(x));</span><br><span class="line">            <span class="keyword">if</span> (colorOf(sib) == RED) &#123;</span><br><span class="line">                setColor(sib, BLACK);                   <span class="comment">// 情况5</span></span><br><span class="line">                setColor(parentOf(x), RED);             <span class="comment">// 情况5</span></span><br><span class="line">                rotateRight(parentOf(x));               <span class="comment">// 情况5</span></span><br><span class="line">                sib = leftOf(parentOf(x));              <span class="comment">// 情况5</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (colorOf(rightOf(sib)) == BLACK &amp;&amp;</span><br><span class="line">                colorOf(leftOf(sib)) == BLACK) &#123;</span><br><span class="line">                setColor(sib, RED);                     <span class="comment">// 情况6</span></span><br><span class="line">                x = parentOf(x);                        <span class="comment">// 情况6</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (colorOf(leftOf(sib)) == BLACK) &#123;</span><br><span class="line">                    setColor(rightOf(sib), BLACK);      <span class="comment">// 情况7</span></span><br><span class="line">                    setColor(sib, RED);                 <span class="comment">// 情况7</span></span><br><span class="line">                    rotateLeft(sib);                    <span class="comment">// 情况7</span></span><br><span class="line">                    sib = leftOf(parentOf(x));          <span class="comment">// 情况7</span></span><br><span class="line">                &#125;</span><br><span class="line">                setColor(sib, colorOf(parentOf(x)));    <span class="comment">// 情况8</span></span><br><span class="line">                setColor(parentOf(x), BLACK);           <span class="comment">// 情况8</span></span><br><span class="line">                setColor(leftOf(sib), BLACK);           <span class="comment">// 情况8</span></span><br><span class="line">                rotateRight(parentOf(x));               <span class="comment">// 情况8</span></span><br><span class="line">                x = root;                               <span class="comment">// 情况8</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    setColor(x, BLACK);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>转载至<a href="https://www.cnblogs.com/CarpenterLee/p/5503882.html" target="_blank" rel="noopener">https://www.cnblogs.com/CarpenterLee/p/5503882.html</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://zzuhai.github.io/2019/06/04/红黑树/" data-id="cjwhlc9680020awuvz8ihis8o" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/数据结构/">数据结构</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-RSA加密使用详解" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/06/04/RSA加密使用详解/" class="article-date">
  <time datetime="2019-06-04T08:29:26.000Z" itemprop="datePublished">2019-06-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/06/04/RSA加密使用详解/">RSA加密使用详解</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>RSAUtils工具类的实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.bouncycastle.jcajce.provider.asymmetric.rsa.RSAUtil;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.Base64Utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.security.Key;</span><br><span class="line"><span class="keyword">import</span> java.security.KeyFactory;</span><br><span class="line"><span class="keyword">import</span> java.security.KeyPair;</span><br><span class="line"><span class="keyword">import</span> java.security.KeyPairGenerator;</span><br><span class="line"><span class="keyword">import</span> java.security.PrivateKey;</span><br><span class="line"><span class="keyword">import</span> java.security.PublicKey;</span><br><span class="line"><span class="keyword">import</span> java.security.Signature;</span><br><span class="line"><span class="keyword">import</span> java.security.interfaces.RSAPrivateKey;</span><br><span class="line"><span class="keyword">import</span> java.security.interfaces.RSAPublicKey;</span><br><span class="line"><span class="keyword">import</span> java.security.spec.PKCS8EncodedKeySpec;</span><br><span class="line"><span class="keyword">import</span> java.security.spec.X509EncodedKeySpec;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.crypto.Cipher;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RSAUtils</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String ENCRYPTION_ALGORITHM = <span class="string">"RSA"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String SIGNATURE_ALGORITHM = <span class="string">"MD5withRSA"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成密钥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String, Object&gt; <span class="title">initKey</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">/* 初始化密钥生成器 */</span></span><br><span class="line">        KeyPairGenerator keyPairGenerator = KeyPairGenerator.getInstance(ENCRYPTION_ALGORITHM);</span><br><span class="line">        keyPairGenerator.initialize(<span class="number">1024</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* 生成密钥 */</span></span><br><span class="line">        KeyPair keyPair = keyPairGenerator.generateKeyPair();</span><br><span class="line">        RSAPublicKey publicKey = (RSAPublicKey) keyPair.getPublic();</span><br><span class="line">        RSAPrivateKey privateKey = (RSAPrivateKey) keyPair.getPrivate();</span><br><span class="line"></span><br><span class="line">        Map&lt;String, Object&gt; keyMap = <span class="keyword">new</span> HashMap&lt;String, Object&gt;(<span class="number">2</span>);</span><br><span class="line">        keyMap.put(<span class="string">"PublicKey"</span>, publicKey);</span><br><span class="line">        keyMap.put(<span class="string">"PrivateKey"</span>, privateKey);</span><br><span class="line">        <span class="keyword">return</span> keyMap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 取得公钥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getPublicKey</span><span class="params">(Map&lt;String, Object&gt; keyMap)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Key key = (Key) keyMap.get(<span class="string">"PublicKey"</span>);</span><br><span class="line">        <span class="keyword">return</span> Base64Utils.encodeToString(key.getEncoded());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 取得私钥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getPrivateKey</span><span class="params">(Map&lt;String, Object&gt; keyMap)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Key key = (Key) keyMap.get(<span class="string">"PrivateKey"</span>);</span><br><span class="line">        <span class="keyword">return</span> Base64Utils.encodeToString(key.getEncoded());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 加密</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] encrypt(<span class="keyword">byte</span>[] data, String keyString, <span class="keyword">boolean</span> isPublic) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        Map&lt;String, Object&gt; keyAndFactoryMap = RSAUtils.generateKeyAndFactory(keyString, isPublic);</span><br><span class="line">        KeyFactory keyFactory = RSAUtils.getKeyFactory(keyAndFactoryMap);</span><br><span class="line">        Key key = RSAUtils.getKey(keyAndFactoryMap);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 对数据加密</span></span><br><span class="line">        Cipher cipher = Cipher.getInstance(keyFactory.getAlgorithm());</span><br><span class="line">        cipher.init(Cipher.ENCRYPT_MODE, key);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> cipher.doFinal(data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 解密</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] decrypt(<span class="keyword">byte</span>[] data, String keyString, <span class="keyword">boolean</span> isPublic) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        Map&lt;String, Object&gt; keyAndFactoryMap = RSAUtils.generateKeyAndFactory(keyString, isPublic);</span><br><span class="line">        KeyFactory keyFactory = RSAUtils.getKeyFactory(keyAndFactoryMap);</span><br><span class="line">        Key key = RSAUtils.getKey(keyAndFactoryMap);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 对数据加密</span></span><br><span class="line">        Cipher cipher = Cipher.getInstance(keyFactory.getAlgorithm());</span><br><span class="line">        cipher.init(Cipher.DECRYPT_MODE, key);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> cipher.doFinal(data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成钥匙</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String, Object&gt; <span class="title">generateKeyAndFactory</span><span class="params">(String keyString, <span class="keyword">boolean</span> isPublic)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">byte</span>[] keyBytes = Base64Utils.decodeFromString(keyString);</span><br><span class="line"></span><br><span class="line">        KeyFactory keyFactory = KeyFactory.getInstance(ENCRYPTION_ALGORITHM);</span><br><span class="line">        Key key = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (isPublic) &#123;</span><br><span class="line">            X509EncodedKeySpec x509KeySpec = <span class="keyword">new</span> X509EncodedKeySpec(keyBytes);</span><br><span class="line">            key = keyFactory.generatePublic(x509KeySpec);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            PKCS8EncodedKeySpec pkcs8KeySpec = <span class="keyword">new</span> PKCS8EncodedKeySpec(keyBytes);</span><br><span class="line">            key = keyFactory.generatePrivate(pkcs8KeySpec);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Map&lt;String, Object&gt; keyAndFactoryMap = <span class="keyword">new</span> HashMap&lt;String, Object&gt;(<span class="number">2</span>);</span><br><span class="line">        keyAndFactoryMap.put(<span class="string">"key"</span>, key);</span><br><span class="line">        keyAndFactoryMap.put(<span class="string">"keyFactory"</span>, keyFactory);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> keyAndFactoryMap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 从指定对象中获取钥匙</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Key <span class="title">getKey</span><span class="params">(Map&lt;String, Object&gt; map)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (map.get(<span class="string">"key"</span>) == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (Key)map.get(<span class="string">"key"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 从指定对象中获取钥匙工厂</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> KeyFactory <span class="title">getKeyFactory</span><span class="params">(Map&lt;String, Object&gt; map)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (map.get(<span class="string">"keyFactory"</span>) == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (KeyFactory)map.get(<span class="string">"keyFactory"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 对信息生成数字签名（用私钥）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">sign</span><span class="params">(<span class="keyword">byte</span>[] data, String keyString)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; keyAndFactoryMap = RSAUtils.generateKeyAndFactory(keyString, <span class="keyword">false</span>);</span><br><span class="line">        Key key = RSAUtils.getKey(keyAndFactoryMap);</span><br><span class="line"></span><br><span class="line">        PrivateKey privateKey = (PrivateKey)key;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 用私钥对信息生成数字签名</span></span><br><span class="line">        Signature signature = Signature.getInstance(SIGNATURE_ALGORITHM);</span><br><span class="line">        signature.initSign(privateKey);</span><br><span class="line">        signature.update(data);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Base64Utils.encodeToString(signature.sign());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 校验数字签名（用公钥）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">verify</span><span class="params">(<span class="keyword">byte</span>[] data, String keyString, String sign)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; keyAndFactoryMap = RSAUtils.generateKeyAndFactory(keyString, <span class="keyword">true</span>);</span><br><span class="line">        Key key = RSAUtils.getKey(keyAndFactoryMap);</span><br><span class="line"></span><br><span class="line">        PublicKey publicKey = (PublicKey)key;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 取公钥匙对象</span></span><br><span class="line">        Signature signature = Signature.getInstance(SIGNATURE_ALGORITHM);</span><br><span class="line">        signature.initVerify(publicKey);</span><br><span class="line">        signature.update(data);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 验证签名是否正常</span></span><br><span class="line">        <span class="keyword">return</span> signature.verify(Base64Utils.decodeFromString(sign));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.Assert.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HowToUse</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String publicKey = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">private</span> String privateKey = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; keyMap = RSAUtil.initKey();</span><br><span class="line">        publicKey = RSAUtil.getPublicKey(keyMap);</span><br><span class="line">        privateKey = RSAUtil.getPrivateKey(keyMap);</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">"公钥 -&gt; "</span> + publicKey);</span><br><span class="line">        System.out.println(<span class="string">"私钥 -&gt; "</span> + privateKey);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"公钥加密，私钥解密"</span>);</span><br><span class="line">        String sourceString = <span class="string">"hi, RSA"</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">byte</span>[] encodedData = RSAUtil.encrypt(sourceString.getBytes(), publicKey, <span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">byte</span>[] decodedData = RSAUtil.decrypt(encodedData, privateKey, <span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line">        String targetString = <span class="keyword">new</span> String(decodedData);</span><br><span class="line">        System.out.println(<span class="string">"加密前: "</span> + sourceString + <span class="string">"，解密后: "</span> + targetString);</span><br><span class="line">        assertEquals(sourceString, targetString);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"私钥签名，公钥验证签名"</span>);</span><br><span class="line">        String sourceString = <span class="string">"hello, RSA sign"</span>;</span><br><span class="line">        <span class="keyword">byte</span>[] data = sourceString.getBytes();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 产生签名</span></span><br><span class="line">        String sign = RSAUtil.sign(data, privateKey);</span><br><span class="line">        System.out.println(<span class="string">"签名 -&gt; "</span> + sign);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 验证签名</span></span><br><span class="line">        <span class="keyword">boolean</span> status = RSAUtil.verify(data, publicKey, sign);</span><br><span class="line">        System.out.println(<span class="string">"状态 -&gt; "</span> + status);</span><br><span class="line">        assertTrue(status);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test3</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"私钥加密，公钥解密"</span>);</span><br><span class="line">        String sourceString = <span class="string">"hello, reRSA"</span>;</span><br><span class="line">        <span class="keyword">byte</span>[] data = sourceString.getBytes();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">byte</span>[] encodedData = RSAUtil.encrypt(data, privateKey, <span class="keyword">false</span>);</span><br><span class="line">        <span class="keyword">byte</span>[] decodedData = RSAUtil.decrypt(encodedData, publicKey, <span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">        String targetString = <span class="keyword">new</span> String(decodedData);</span><br><span class="line">        System.out.println(<span class="string">"加密前: "</span> + sourceString + <span class="string">"，解密后: "</span> + targetString);</span><br><span class="line">        assertEquals(sourceString, targetString);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://zzuhai.github.io/2019/06/04/RSA加密使用详解/" data-id="cjwhlc95c000hawuvidj9wlyg" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/">java</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-cron表达式详解" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/06/04/cron表达式详解/" class="article-date">
  <time datetime="2019-06-04T08:29:10.000Z" itemprop="datePublished">2019-06-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/06/04/cron表达式详解/">cron表达式详解</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>cron表达式<br>* * * * * ? *
分别表示的是秒，分，时，日，月，周，年<br>其中年可以省略<br><img src="https://img-blog.csdnimg.cn/20190604105746690.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzM1NzU3NDg4,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h6 id="星号"><a href="#星号" class="headerlink" title="* 星号"></a>* 星号</h6><p>使用星号(<em>) 指示着你想在这个域上包含所有合法的值。例如，</em>在分钟字段时，表示“每分钟”<br>如 0 * 17 * * ?，每天从下午5点到下午5:59中的每分钟激发一次</p>
<h6 id="问号"><a href="#问号" class="headerlink" title="? 问号"></a>? 问号</h6><p>该字符只在日期和星期字段中使用，它通常指定为“无意义的值”，相当于点位符<br>? 是说不为该域指定值，这不同于星号，星号是指示着该域上的每一个值。<br>? 号只能用在日和周域上，但是不能在这两个域上同时使用<br>假如你为这两域的其中一个指定了值，那就必须在另一个字值上放一个 ?</p>
<h6 id="逗号"><a href="#逗号" class="headerlink" title=", 逗号"></a>, 逗号</h6><p>逗号 (,) 是用来在给某个域上指定一个值列表的<br>如：0,15,30,45 * * * * ?</p>
<h6 id="斜杠"><a href="#斜杠" class="headerlink" title="/ 斜杠"></a>/ 斜杠</h6><p>斜杠 (/) 是用于时间表的递增的<br>x/y表达一个等步长序列，x为起始值，y为增量步长值<br>如：0/15 * * * * ?，表示每15秒执行一次，当秒为0，15，30，45的时候执行</p>
<h6 id="中划线"><a href="#中划线" class="headerlink" title="- 中划线"></a>- 中划线</h6><p>中划线 (-) 用于指定一个范围<br>如：0 45 3-8 ? * *，在上午的3点至上午的8点期间，分钟数为45分时触发</p>
<h6 id="L-字母"><a href="#L-字母" class="headerlink" title="L 字母"></a>L 字母</h6><p>L 说明了某域上允许的最后一个值。它仅被日和周域支持<br>当用在日域上，表示的是在月域上指定的月份的最后一天<br>如：日域上0 0 8 L * ?，意义是在每个月最后一天的上午 8:00 触发<br>当 L 字母用于周域上，指示着周的最后一天，就是星期六 (或者数字7)（国际惯例）<br>如：0 59 23 ? * L，在每个月的最后一个星期六晚上的 11:59 触发<br>当使用于周域上，你可以用一个数字与 L 连起来表示月份的最后一个星期 X<br>如0 0 12 ? * 2L 说的是在每个月的最后一个星期一触发 trigger</p>
<h6 id="W-字母"><a href="#W-字母" class="headerlink" title="W 字母"></a>W 字母</h6><p>W 字符代表着平日 (Mon-Fri)，并且仅能用于日域中<br>如：0 0 8 15W * ？，离该月15号的最近一个平日执行</p>
<h6 id="井号"><a href="#井号" class="headerlink" title="井号"></a>井号</h6><p>字符仅能用于周域中。它用于指定月份中的第几周的哪一天<br>如：0 0 8 ? 5 1#2,表示5月的第二个星期天早上8点触发</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://zzuhai.github.io/2019/06/04/cron表达式详解/" data-id="cjwhlc95h000oawuvyf57ugru" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/">java</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-quartz定时任务的使用" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/06/04/quartz定时任务的使用/" class="article-date">
  <time datetime="2019-06-04T08:28:50.000Z" itemprop="datePublished">2019-06-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/06/04/quartz定时任务的使用/">quartz定时任务的使用</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>需要加入jar包和配置文件<br>待分享</p>
<p>配置文件需要修改的地方：<br><img src="https://img-blog.csdnimg.cn/20190604104118845.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzM1NzU3NDg4,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>调用的方法：<br><img src="https://img-blog.csdnimg.cn/20190604104331626.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzM1NzU3NDg4,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>说明：<br>targetObject：想启动方法所在类的注解名<br>targetMethod：想启动的方法名（注意这个方法不能有入参，不然会找不到方法）<br>concurrent：为false时表示一次执行完了才执行下一次</p>
<p>需要配置文件中配置频率<br>cronExpression=0/5 * * * * ? *</p>
<p>频率的具体配置见：<a href="https://blog.csdn.net/sinat_35757488/article/details/90764912" target="_blank" rel="noopener">cron表达式详解</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://zzuhai.github.io/2019/06/04/quartz定时任务的使用/" data-id="cjwhlc95n000yawuveybtfquk" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/">java</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Java导出数据到excel" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/06/04/Java导出数据到excel/" class="article-date">
  <time datetime="2019-06-04T08:28:16.000Z" itemprop="datePublished">2019-06-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/06/04/Java导出数据到excel/">Java导出数据到excel</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h5 id="1-需要添加这个初始化excel的model类到项目中"><a href="#1-需要添加这个初始化excel的model类到项目中" class="headerlink" title="1.需要添加这个初始化excel的model类到项目中"></a>1.需要添加这个初始化excel的model类到项目中</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.poi.hssf.usermodel.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.math.BigDecimal;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Objects;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wanjinjun</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: 导出</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> Created in: 16:35 2018/8/19</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExportExcel</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 表头</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 各个列的表头</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String[] heardList;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 各个列的元素key值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String[] heardKey;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 需要填充的数据信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Map&lt;String, String&gt;&gt; data;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 字体大小</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> fontSize = <span class="number">14</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 行高</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> rowHeight = <span class="number">30</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 列宽</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> columWidth = <span class="number">200</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 工作表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String sheetName = <span class="string">"sheet1"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTitle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> title;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Map&lt;String, String&gt;&gt; getData() &#123;</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ExportExcel <span class="title">setData</span><span class="params">(List&lt;Map&lt;String, String&gt;&gt; data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.data = data;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ExportExcel <span class="title">setTitle</span><span class="params">(String title)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.title = title;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String[] getHeardList() &#123;</span><br><span class="line">        <span class="keyword">return</span> heardList;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ExportExcel <span class="title">setHeardList</span><span class="params">(String[] heardList)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.heardList = heardList;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String[] getHeardKey() &#123;</span><br><span class="line">        <span class="keyword">return</span> heardKey;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ExportExcel <span class="title">setHeardKey</span><span class="params">(String[] heardKey)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.heardKey = heardKey;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getFontSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> fontSize;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ExportExcel <span class="title">setFontSize</span><span class="params">(<span class="keyword">int</span> fontSize)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.fontSize = fontSize;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getRowHeight</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> rowHeight;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ExportExcel <span class="title">setRowHeight</span><span class="params">(<span class="keyword">int</span> rowHeight)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.rowHeight = rowHeight;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getColumWidth</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> columWidth;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ExportExcel <span class="title">setColumWidth</span><span class="params">(<span class="keyword">int</span> columWidth)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.columWidth = columWidth;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getSheetName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sheetName;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ExportExcel <span class="title">setSheetName</span><span class="params">(String sheetName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.sheetName = sheetName;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 开始导出数据信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ByteArrayOutputStream <span class="title">exportExport</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ByteArrayOutputStream os = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line">        <span class="comment">//创建工作簿</span></span><br><span class="line">        HSSFWorkbook wb = <span class="keyword">new</span> HSSFWorkbook();</span><br><span class="line">        <span class="comment">//创建工作表</span></span><br><span class="line">        HSSFSheet wbSheet = wb.createSheet(<span class="keyword">this</span>.sheetName);</span><br><span class="line">        <span class="comment">//设置列宽、行高</span></span><br><span class="line">        wbSheet.setColumnWidth(<span class="number">0</span>, <span class="number">252</span> * <span class="number">20</span> + <span class="number">323</span>);</span><br><span class="line">        <span class="comment">//在第0行创建rows</span></span><br><span class="line">        HSSFRow row = wbSheet.createRow((<span class="keyword">int</span>) <span class="number">0</span>);</span><br><span class="line">        wbSheet.setDefaultColumnWidth(<span class="number">20</span>);</span><br><span class="line">        <span class="comment">//创建单元格，设置表头，表头居中</span></span><br><span class="line">        HSSFCellStyle style = wb.createCellStyle();</span><br><span class="line">        <span class="comment">//设置单元格样式</span></span><br><span class="line">        style.setAlignment(HSSFCellStyle.ALIGN_LEFT);</span><br><span class="line">        style.setVerticalAlignment(HSSFCellStyle.VERTICAL_CENTER);</span><br><span class="line">        HSSFFont font = wb.createFont();</span><br><span class="line">        font.setFontHeightInPoints((<span class="keyword">short</span>) <span class="keyword">this</span>.fontSize);</span><br><span class="line">        <span class="comment">//设置列头元素</span></span><br><span class="line">        HSSFCell cellHead = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; heardList.length; i++) &#123;</span><br><span class="line">            cellHead = row.createCell(i);</span><br><span class="line">            cellHead.setCellValue(heardList[i]);</span><br><span class="line">            cellHead.setCellStyle(style);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//开始写入实体数据信息</span></span><br><span class="line">        style.setFont(font);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; data.size(); i++) &#123;</span><br><span class="line">            HSSFRow roww = wbSheet.createRow((<span class="keyword">int</span>) i + <span class="number">1</span>);</span><br><span class="line">            Map map = data.get(i);</span><br><span class="line">            HSSFCell cell = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; heardKey.length; j++) &#123;</span><br><span class="line">                cell = roww.createCell(j);</span><br><span class="line">                cell.setCellStyle(style);</span><br><span class="line">                Object valueObject = map.get(heardKey[j]);</span><br><span class="line">                String value = <span class="keyword">null</span>;</span><br><span class="line">                <span class="keyword">if</span> (valueObject == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    valueObject = <span class="string">""</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (valueObject <span class="keyword">instanceof</span> String) &#123;</span><br><span class="line">                    <span class="comment">//取出的数据是字符串直接赋值</span></span><br><span class="line">                    value = (String) map.get(heardKey[j]);</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (valueObject <span class="keyword">instanceof</span> Integer) &#123;</span><br><span class="line">                    <span class="comment">//取出的数据是Integer</span></span><br><span class="line">                    value = String.valueOf(((Integer) (valueObject)).floatValue());</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (valueObject <span class="keyword">instanceof</span> BigDecimal) &#123;</span><br><span class="line">                    <span class="comment">//取出的数据是BigDecimal</span></span><br><span class="line">                    value = String.valueOf(((BigDecimal) (valueObject)).floatValue());</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    value = valueObject.toString();</span><br><span class="line">                &#125;</span><br><span class="line">                cell.setCellValue((value == <span class="keyword">null</span> || Objects.equals(value, <span class="string">""</span>)) ? <span class="string">""</span> : value);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//设置行高</span></span><br><span class="line">        <span class="comment">//设置行高的过程需要注意的一不包含标题</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; data.size() + <span class="number">1</span>; i++) &#123;</span><br><span class="line">            HSSFRow hssfRow = wbSheet.getRow(i);</span><br><span class="line">            hssfRow.setHeightInPoints(<span class="keyword">this</span>.rowHeight);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            wb.write(os);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> os;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用这个model类的时候，需要在pom文件中添加以下依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.poi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>poi-ooxml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.14<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h6 id="2-实现导出数据到excel中的代码"><a href="#2-实现导出数据到excel中的代码" class="headerlink" title="2.实现导出数据到excel中的代码"></a>2.实现导出数据到excel中的代码</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">ExportExcel excelExport = <span class="keyword">new</span> ExportExcel();</span><br><span class="line"><span class="comment">//初始化表头信息</span></span><br><span class="line">String[] headerList = &#123;<span class="string">"EmpID"</span>, <span class="string">"LoginAccount"</span>, <span class="string">"LoginAccountType"</span>, <span class="string">"Name"</span>, <span class="string">"Sex"</span>, <span class="string">"NamePY"</span>, <span class="string">"EnglishName"</span>, <span class="string">"BirthDate"</span>, <span class="string">"SystemID"</span>, <span class="string">"Errmsg"</span>&#125;;</span><br><span class="line"><span class="comment">//初始化excelExport（使用了建造者模式），fialureOpenUserData是list&lt;Map&lt;String,String&gt;&gt;类型</span></span><br><span class="line">ByteArrayOutputStream outputStream = excelExport.setHeardKey(headerList).setData(fialureOpenUserData).setHeardList(headerList).exportExport();</span><br><span class="line">save(outputStream, <span class="string">"开户失败员工记录"</span>);<span class="comment">//excel表名的前缀</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 保存数据到到excel中的方法</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> outputStream</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> prefix 文件名前缀</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">save</span><span class="params">(ByteArrayOutputStream outputStream, String prefix)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    String fileName = prefix + <span class="string">"-"</span> + UUID.randomUUID().toString() + <span class="string">".xls"</span>;</span><br><span class="line"></span><br><span class="line">    File dir = <span class="keyword">new</span> File(path);</span><br><span class="line">    <span class="keyword">if</span> (!dir.exists() &amp;&amp; !dir.mkdirs()) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">"创建excel目录失败"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    File excelFile = <span class="keyword">new</span> File(dir.getAbsolutePath(), fileName);</span><br><span class="line">    <span class="keyword">try</span> (</span><br><span class="line">            FileOutputStream fop = <span class="keyword">new</span> FileOutputStream(excelFile);</span><br><span class="line">            <span class="comment">// 打开本地文件流</span></span><br><span class="line">            InputStream inputStream = <span class="keyword">new</span> ByteArrayInputStream(outputStream.toByteArray());</span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="comment">//循环写入输出流</span></span><br><span class="line">        <span class="keyword">byte</span>[] b = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">2048</span>];</span><br><span class="line">        <span class="keyword">int</span> length;</span><br><span class="line">        <span class="keyword">while</span> ((length = inputStream.read(b)) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            fop.write(b, <span class="number">0</span>, length);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">"生成EXCEL文件失败!"</span>, e);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> fileName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这当中用到的流的包都是java.io下的包</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://zzuhai.github.io/2019/06/04/Java导出数据到excel/" data-id="cjwhlc959000dawuvarvkkmat" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/">java</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Guava缓存的使用" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/06/04/Guava缓存的使用/" class="article-date">
  <time datetime="2019-06-04T08:27:59.000Z" itemprop="datePublished">2019-06-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/06/04/Guava缓存的使用/">Guava缓存的使用</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h6 id="适用于"><a href="#适用于" class="headerlink" title="适用于"></a>适用于</h6><p>你愿意消耗一些内存空间来提升速度。<br>你预料到某些键会被查询一次以上。<br>缓存中存放的数据总量不会超出内存容量。</p>
<h5 id="cacheLoader方式"><a href="#cacheLoader方式" class="headerlink" title="cacheLoader方式"></a>cacheLoader方式</h5><p>//这种方式的返回值不能为null，会报异常<br>//这种方式使用get方法来获取缓存的值<br>//使用put赋值缓存，put里面传入的是缓存的key和入参，value值是load方法返回值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testLoadingCache</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">//标红的是入参和返回值</span></span><br><span class="line">    LoadingCache&lt;String, String&gt; cahceBuilder = CacheBuilder.newBuilder().build(<span class="keyword">new</span> CacheLoader&lt;String, String&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">load</span><span class="params">(String key)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">"请求的key为"</span> + key + <span class="string">"在缓存中不存在,通过load方法获取key."</span>); String strProValue = <span class="string">"hello "</span> + key + <span class="string">"!"</span>;</span><br><span class="line">            <span class="keyword">return</span> strProValue;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;); </span><br><span class="line">    System.out.println(<span class="string">"a value:"</span> + cahceBuilder.get(<span class="string">"a"</span>));</span><br><span class="line">    cahceBuilder.put(<span class="string">"b"</span>, <span class="string">"bbbb"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="callable-callback方式"><a href="#callable-callback方式" class="headerlink" title="callable callback方式"></a>callable callback方式</h5><p>//这种方式更加的灵活。可以在要使用的时候直接get<br>//这种方式使用getIfPresent方法来获取缓存的值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testcallableCache</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    Cache&lt;String, String&gt; cache = CacheBuilder.newBuilder().maximumSize(<span class="number">1000</span>).build();</span><br><span class="line">    String resultVal = cache.get(<span class="string">"a"</span>, <span class="keyword">new</span> Callable&lt;String&gt;() &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">call</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            String strProValue = <span class="string">"hello "</span> + <span class="string">"a"</span> + <span class="string">"!"</span>;</span><br><span class="line">            <span class="keyword">return</span> strProValue;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    System.out.println(<span class="string">"a value : "</span> + resultVal);</span><br><span class="line"></span><br><span class="line">    resultVal = cache.getIfPresent(<span class="string">"b"</span>);</span><br><span class="line">    System.out.println(<span class="string">"a value : "</span> + resultVal);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="回收的参数："><a href="#回收的参数：" class="headerlink" title="回收的参数："></a>回收的参数：</h6><p>　　1. 大小的设置：CacheBuilder.maximumSize(long) CacheBuilder.weigher(Weigher) CacheBuilder.maxumumWeigher(long)<br>　　2. 时间：expireAfterAccess(long, TimeUnit) expireAfterWrite(long, TimeUnit)<br>　　3. 引用：CacheBuilder.weakKeys() CacheBuilder.weakValues() CacheBuilder.softValues()<br>　　4. 明确的删除：invalidate(key) invalidateAll(keys) invalidateAll()<br>　　5. 删除监听器：CacheBuilder.removalListener(RemovalListener) </p>
<h6 id="refresh机制："><a href="#refresh机制：" class="headerlink" title="refresh机制："></a>refresh机制：</h6><p>　　1. LoadingCache.refresh(K) 在生成新的value的时候，旧的value依然会被使用。<br>　　2. CacheLoader.reload(K, V) 生成新的value过程中允许使用旧的value<br>　　3. CacheBuilder.refreshAfterWrite(long, TimeUnit) 自动刷新cache</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://zzuhai.github.io/2019/06/04/Guava缓存的使用/" data-id="cjwhlc9550009awuvn0olyifp" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/缓存/">缓存</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-SQL学习" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/06/04/SQL学习/" class="article-date">
  <time datetime="2019-06-04T08:26:03.000Z" itemprop="datePublished">2019-06-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/06/04/SQL学习/">SQL学习</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>登录mysql命令（mysql的bin目录下输入）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -hlocalhost -uroot -p</span><br></pre></td></tr></table></figure>

<h1 id="SQL语句"><a href="#SQL语句" class="headerlink" title="SQL语句"></a>SQL语句</h1><h4 id="sql分类"><a href="#sql分类" class="headerlink" title="sql分类"></a>sql分类</h4><h6 id="DDL（Data-Definition-Language，数据定义语言）"><a href="#DDL（Data-Definition-Language，数据定义语言）" class="headerlink" title="DDL（Data Definition Language，数据定义语言）"></a>DDL（Data Definition Language，数据定义语言）</h6><ul>
<li>CREATE ： 创建数据库和表等对象DROP ： 删除数据库和表等对象</li>
<li>ALTER ： 修改数据库和表等对象的结构 <h6 id="DML（Data-Manipulation-Language，数据操纵语言）"><a href="#DML（Data-Manipulation-Language，数据操纵语言）" class="headerlink" title="DML（Data Manipulation Language，数据操纵语言）"></a>DML（Data Manipulation Language，数据操纵语言）</h6></li>
<li>SELECT ：查询表中的数据</li>
<li>INSERT ：向表中插入新数据</li>
<li>UPDATE ：更新表中的数据</li>
<li>DELETE ：删除表中的数据 <h6 id="DCL（Data-Control-Language，数据控制语言）"><a href="#DCL（Data-Control-Language，数据控制语言）" class="headerlink" title="DCL（Data Control Language，数据控制语言）"></a>DCL（Data Control Language，数据控制语言）</h6></li>
<li>COMMIT ： 确认对数据库中的数据进行的变更</li>
<li>ROLLBACK ： 取消对数据库中的数据进行的变更</li>
<li>GRANT ： 赋予用户操作权限</li>
<li>REVOKE ： 取消用户的操作权限</li>
</ul>
<h4 id="建库语句"><a href="#建库语句" class="headerlink" title="建库语句"></a>建库语句</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> 库名;</span><br></pre></td></tr></table></figure>

<h4 id="建表语句"><a href="#建表语句" class="headerlink" title="建表语句"></a>建表语句</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Product</span><br><span class="line">(product_id <span class="built_in">CHAR</span>(<span class="number">4</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">product_name <span class="built_in">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">product_type <span class="built_in">VARCHAR</span>(<span class="number">32</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">sale_price <span class="built_in">INTEGER</span> ,</span><br><span class="line">purchase_price <span class="built_in">INTEGER</span> ,</span><br><span class="line">regist_date <span class="built_in">DATE</span> ,</span><br><span class="line">PRIMARY <span class="keyword">KEY</span> (product_id));</span><br></pre></td></tr></table></figure>

<h4 id="查询去重-DISTINCT"><a href="#查询去重-DISTINCT" class="headerlink" title="查询去重 DISTINCT"></a>查询去重 DISTINCT</h4><p>只能用在第一个列名之前。不能写成 regist _ date , DISTINCT product _ type </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> product_type, regist_date <span class="keyword">FROM</span> Product;</span><br></pre></td></tr></table></figure>

<h4 id="关联查询"><a href="#关联查询" class="headerlink" title="关联查询"></a>关联查询</h4><p>inner join on：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> tch_teacher <span class="keyword">inner</span> <span class="keyword">join</span> tch_contact <span class="keyword">on</span> tch_teacher.Id = tch_contact.TId;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> tch_teacher,tch_contact</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> tch_teacher <span class="keyword">join</span> tch_contact</span><br></pre></td></tr></table></figure>

<p>right/left join on:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> tch_teacher <span class="keyword">right</span>/<span class="keyword">left</span> <span class="keyword">join</span> tch_contact <span class="keyword">on</span> tch_teacher.Id = tch_contact.TId;</span><br></pre></td></tr></table></figure>

<h4 id="排序查询"><a href="#排序查询" class="headerlink" title="排序查询"></a>排序查询</h4><p>order by</p>
<ol>
<li>ASC：默认，不写也是ASC：按照升序的方式排列;</li>
<li>DESC：按照降序的方式排列；<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> emp <span class="keyword">ORDER</span> <span class="keyword">BY</span> sal <span class="keyword">DESC</span>;//降序</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> emp <span class="keyword">ORDER</span> <span class="keyword">BY</span> sal <span class="keyword">ASC</span>;//升序</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> emp <span class="keyword">ORDER</span> <span class="keyword">BY</span> sal;//升序</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h4 id="分组查询"><a href="#分组查询" class="headerlink" title="分组查询"></a>分组查询</h4><p>HAVING核心：是对分组统计之后的结果集，进行数据的筛选</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>  GradeId,sex,<span class="keyword">COUNT</span>(*)  <span class="keyword">as</span> renshu <span class="keyword">from</span> student  <span class="keyword">group</span> <span class="keyword">by</span> GradeId,Sex  <span class="keyword">having</span> <span class="keyword">count</span>(*)&gt;=<span class="number">3</span> <span class="keyword">order</span> <span class="keyword">by</span> GradeId</span><br></pre></td></tr></table></figure>

<h4 id="逻辑关键字"><a href="#逻辑关键字" class="headerlink" title="逻辑关键字"></a>逻辑关键字</h4><p><img src="https://img-blog.csdnimg.cn/20190307103049554.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzMwNDY4NTUx,size_16,color_FFFFFF,t_70" alt="image"></p>
<h4 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h4><p>sum<br>count<br>avg<br>max<br>min</p>
<h5 id="where-与-having："><a href="#where-与-having：" class="headerlink" title="where 与 having："></a>where 与 having：</h5><p>where 与 having关键字都用于设置条件表达式对查询结果进行过滤，区别是<strong>having后面可以跟聚合函数</strong>，而where不能，通常having关键字都与group by 一起使用，表示对分组后的数据进行过滤</p>
<h1 id="引擎"><a href="#引擎" class="headerlink" title="引擎"></a>引擎</h1><h6 id="MyIASM"><a href="#MyIASM" class="headerlink" title="MyIASM"></a>MyIASM</h6><p>支持全文检索，查询效率比较高，<br>不支持事务，表级锁</p>
<h6 id="InnoDB"><a href="#InnoDB" class="headerlink" title="InnoDB"></a>InnoDB</h6><p>支持事务，外键，支持行级锁提高并发效率，自动加排它锁</p>
<h6 id="TokuDB"><a href="#TokuDB" class="headerlink" title="TokuDB"></a>TokuDB</h6><p>写速度快，支持数据压缩存储，可以在线添加索引不影响读写操作，不适合大量读写操作</p>
<h1 id="锁"><a href="#锁" class="headerlink" title="锁"></a>锁</h1><h6 id="表锁"><a href="#表锁" class="headerlink" title="表锁"></a>表锁</h6><p>开销小，加锁快，不会出现死锁，锁定力度大，锁冲突概率高，并发访问效率比较低</p>
<h6 id="行级锁"><a href="#行级锁" class="headerlink" title="行级锁"></a>行级锁</h6><p>开销大，加锁慢，会出现死锁，锁定力度小，锁的冲突概率低，并发访问效率比较高</p>
<h6 id="共享锁"><a href="#共享锁" class="headerlink" title="共享锁"></a>共享锁</h6><p>读锁，其他事物可以读，不能写</p>
<h6 id="排它锁"><a href="#排它锁" class="headerlink" title="排它锁"></a>排它锁</h6><p>写锁，其他事物不能读取也不能写，</p>
<h1 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h1><h4 id="索引的类型"><a href="#索引的类型" class="headerlink" title="索引的类型"></a>索引的类型</h4><ul>
<li>UNIQUE(唯一索引)：<br>不可以出现相同的值，可以有NULL值</li>
<li>INDEX(普通索引)：允许出现相同的索引内容</li>
<li>PROMARY KEY(主键索引)：不允许出现相同的值</li>
<li>fulltext index(全文索引)：可以针对值中的某个单词，但效率确实不敢恭维</li>
<li>组合索引：实质上是将多个字段建到一个索引里，列值的组合必须唯一</li>
</ul>
<h6 id="添加索引"><a href="#添加索引" class="headerlink" title="添加索引"></a>添加索引</h6><p>ALTER TABLE 表名 ADD 索引类型 （unique,primary key,fulltext,index）[索引名]（字段名）<br>如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> table_name <span class="keyword">add</span> <span class="keyword">index</span> index_name (column_list) ;</span><br></pre></td></tr></table></figure>

<h6 id="组合索引"><a href="#组合索引" class="headerlink" title="组合索引"></a>组合索引</h6><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> USER_DEMO <span class="keyword">ADD</span> <span class="keyword">INDEX</span> name_city_age (LOGIN_NAME(<span class="number">16</span>),CITY,AGE);</span><br></pre></td></tr></table></figure>

<h6 id="建表时增加索引"><a href="#建表时增加索引" class="headerlink" title="建表时增加索引"></a>建表时增加索引</h6><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">INDEX</span> index_name <span class="keyword">ON</span> table_name(username(<span class="keyword">length</span>));</span><br></pre></td></tr></table></figure>

<h6 id="删除索引"><a href="#删除索引" class="headerlink" title="删除索引"></a>删除索引</h6><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">index</span> index_name <span class="keyword">on</span> table_name ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> table_name <span class="keyword">drop</span> <span class="keyword">index</span> index_name ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> table_name <span class="keyword">drop</span> primary <span class="keyword">key</span> ;</span><br></pre></td></tr></table></figure>

<h5 id="索引的缺点"><a href="#索引的缺点" class="headerlink" title="索引的缺点"></a>索引的缺点</h5><ul>
<li>虽然索引大大提高了查询速度，同时却会降低更新表的速度，如对表进行INSERT,UPDATE和DELETE。因为更新表时，mysql不仅要保存数据，还要保存一下索引文件</li>
<li>建立索引会占用磁盘空间的索引文件。一般情况这个问题不太严重，但如果你在要给大表上建了多种组合索引，索引文件会膨胀很宽</li>
</ul>
<h5 id="使用索引的技巧"><a href="#使用索引的技巧" class="headerlink" title="使用索引的技巧"></a>使用索引的技巧</h5><ol>
<li><p>索引不会包含有NULL的列</p>
<pre><code>只要列中包含有NULL值，都将不会被包含在索引中，复合索引中只要有一列含有NULL值，那么这一列对于此复合索引就是无效的。</code></pre></li>
<li><p>使用短索引</p>
<pre><code>对串列进行索引，如果可以就应该指定一个前缀长度。例如，如果有一个char（255）的列，如果在前10个或20个字符内，多数值是唯一的，那么就不要对整个列进行索引。短索引不仅可以提高查询速度而且可以节省磁盘空间和I/O操作。</code></pre></li>
<li><p>索引列排序</p>
<pre><code>mysql查询只使用一个索引，因此如果where子句中已经使用了索引的话，那么order by中的列是不会使用索引的。因此数据库默认排序可以符合要求的情况下不要使用排序操作，尽量不要包含多个列的排序，如果需要最好给这些列建复合索引。</code></pre></li>
<li><p>like语句操作</p>
<p>   一般情况下不鼓励使用like操作，如果非使用不可，注意正确的使用方式。like ‘%aaa%’不会使用索引，而like ‘aaa%’可以使用索引。</p>
</li>
<li><p>不要在列上进行运算</p>
</li>
<li><p>不使用NOT IN 、&lt;&gt;、！=操作，但&lt;,&lt;=，=，&gt;,&gt;=,BETWEEN,IN是可以用到索引的</p>
</li>
<li><p>索引要建立在经常进行select操作的字段上。</p>
<pre><code>这是因为，如果这些列很少用到，那么有无索引并不能明显改变查询速度。相反，由于增加了索引，反而降低了系统的维护速度和增大了空间需求。</code></pre></li>
<li><p>索引要建立在值比较唯一的字段上。</p>
</li>
<li><p>对于那些定义为text、image和bit数据类型的列不应该增加索引。因为这些列的数据量要么相当大，要么取值很少。</p>
</li>
<li><p>在where和join中出现的列需要建立索引。</p>
</li>
<li><p>where的查询条件里有不等号(where column != …),mysql将无法使用索引。</p>
</li>
<li><p>如果where字句的查询条件里使用了函数(如：where DAY(column)=…),mysql将无法使用索引。</p>
</li>
<li><p>在join操作中(需要从多个数据表提取数据时)，mysql只有在主键和外键的数据类型相同时才能使用索引，否则及时建立了索引也不会使用。</p>
</li>
</ol>
<h4 id="索引实现"><a href="#索引实现" class="headerlink" title="索引实现"></a>索引实现</h4><ol>
<li>FULLTEXT</li>
</ol>
<p>即为全文索引，目前只有MyISAM引擎支持。其可以在CREATE TABLE ，ALTER TABLE ，CREATE INDEX 使用，不过目前只有 CHAR、VARCHAR ，TEXT 列上可以创建全文索引。</p>
<p>全文索引并不是和MyISAM一起诞生的，它的出现是为了解决WHERE name LIKE “%word%”这类针对文本的模糊查询效率较低的问题。</p>
<ol start="2">
<li>HASH</li>
</ol>
<p>由于HASH的唯一（几乎100%的唯一）及类似键值对的形式，很适合作为索引。</p>
<p>HASH索引可以一次定位，不需要像树形索引那样逐层查找,因此具有极高的效率。但是，这种高效是有条件的，即只在“=”和“in”条件下高效，对于范围查询、排序及组合索引仍然效率不高。</p>
<ol start="3">
<li>BTREE</li>
</ol>
<p>BTREE索引就是一种将索引值按一定的算法，存入一个树形的数据结构中（二叉树），每次查询都是从树的入口root开始，依次遍历node，获取leaf。这是MySQL里默认和最常用的索引类型。</p>
<ol start="4">
<li>RTREE</li>
</ol>
<p>RTREE在MySQL很少使用，仅支持geometry数据类型，支持该类型的存储引擎只有MyISAM、BDb、InnoDb、NDb、Archive几种。</p>
<h1 id="sql优化"><a href="#sql优化" class="headerlink" title="sql优化"></a>sql优化</h1><h6 id="表结构和索引优化"><a href="#表结构和索引优化" class="headerlink" title="表结构和索引优化"></a>表结构和索引优化</h6><ul>
<li>分库分表，读写分离</li>
<li>为字段选择合适的数据类型</li>
<li>将字段多的表分解成多个表，增加中间表</li>
<li>混用范式与反范式，适当冗余</li>
<li>为查询创建必要索引，但避免滥用</li>
<li>尽可能的使⽤用 NOT NULL<h6 id="sql语句优化"><a href="#sql语句优化" class="headerlink" title="sql语句优化"></a>sql语句优化</h6></li>
<li>寻找最需要优化的语句句：分析慢查询日志</li>
<li>利用分析工具：explain、profile</li>
<li>避免使用SELECT *，只取需要的列列</li>
<li>尽量量使用prepared statements</li>
<li>使⽤用索引扫描来排序</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://zzuhai.github.io/2019/06/04/SQL学习/" data-id="cjwhlc966001wawuv0q6cxq7t" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/数据库/">数据库</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-spring-boot发送邮件mail" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/06/04/spring-boot发送邮件mail/" class="article-date">
  <time datetime="2019-06-04T08:25:21.000Z" itemprop="datePublished">2019-06-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/06/04/spring-boot发送邮件mail/">spring boot发送邮件mail</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>创建spring boot项目，添加邮件的依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-mail<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>application.properties中新增配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"># 设置邮箱主机</span><br><span class="line">spring.mail.host=smtp.163.com</span><br><span class="line"># qq邮箱的host</span><br><span class="line">#spring.mail.host=smtp.qq.com</span><br><span class="line"> </span><br><span class="line"># 设置用户名</span><br><span class="line">spring.mail.username=你的邮箱地址</span><br><span class="line"> </span><br><span class="line"># 设置密码，该处的密码是QQ邮箱开启SMTP的授权码而非QQ密码，登录qq邮箱，进入设置开启，得到授权码</span><br><span class="line"># 163邮箱就是邮箱密码</span><br><span class="line">spring.mail.password=你的邮箱密码</span><br><span class="line"></span><br><span class="line"># 设置编码集</span><br><span class="line">spring.mail.<span class="keyword">default</span>-encoding=UTF-<span class="number">8</span></span><br><span class="line"> </span><br><span class="line"># 设置是否需要认证，如果为true,那么用户名和密码就必须的，</span><br><span class="line"># 如果设置false，可以不设置用户名和密码，当然也得看你的对接的平台是否支持无密码进行访问的。</span><br><span class="line">spring.mail.properties.mail.smtp.auth=<span class="keyword">true</span></span><br><span class="line"> </span><br><span class="line"># STARTTLS[1]  是对纯文本通信协议的扩展。它提供一种方式将纯文本连接升级为加密连接（TLS或SSL），而不是另外使用一个端口作加密通信。</span><br><span class="line">spring.mail.properties.mail.smtp.starttls.enable=<span class="keyword">true</span></span><br><span class="line">spring.mail.properties.mail.smtp.starttls.required=<span class="keyword">true</span></span><br><span class="line"> </span><br><span class="line"># 以谁来发送邮件	</span><br><span class="line">mail.fromMail=发送方邮件地址</span><br><span class="line"># 发送给谁</span><br><span class="line">mail.tomail=接收方邮件地址</span><br></pre></td></tr></table></figure>

<h4 id="一、发送简单的邮件"><a href="#一、发送简单的邮件" class="headerlink" title="一、发送简单的邮件"></a>一、发送简单的邮件</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> JavaMailSender mailSender;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendSimpleMail</span><span class="params">(String to, String subject, String content)</span> </span>&#123;</span><br><span class="line">	SimpleMailMessage simpleMailMessage = <span class="keyword">new</span> SimpleMailMessage();</span><br><span class="line">	simpleMailMessage.setSubject(subject);</span><br><span class="line">	simpleMailMessage.setTo(to);</span><br><span class="line">	simpleMailMessage.setText(content);</span><br><span class="line">	simpleMailMessage.setFrom(mailFrom);</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		mailSender.send(simpleMailMessage);</span><br><span class="line">		System.out.println(<span class="string">"发送成功"</span>);</span><br><span class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">		e.printStackTrace();</span><br><span class="line">		System.out.println(<span class="string">"发送失败"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试一下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSendSimpleMail</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	mailserviceImpl.sendSimpleMail(toMail, <span class="string">"测试一下简单的邮件发送"</span>, <span class="string">"简单的邮件发送成功"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="二、发送带附件的邮件"><a href="#二、发送带附件的邮件" class="headerlink" title="二、发送带附件的邮件"></a>二、发送带附件的邮件</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> JavaMailSender mailSender;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendAttachmentsMail</span><span class="params">(String to, String subject, String content, String filePath)</span> </span>&#123;</span><br><span class="line">	MimeMessage message = mailSender.createMimeMessage();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		MimeMessageHelper helper = <span class="keyword">new</span> MimeMessageHelper(message, <span class="keyword">true</span>);</span><br><span class="line">		helper.setFrom(mailFrom);</span><br><span class="line">		helper.setTo(to);</span><br><span class="line">		helper.setSubject(subject);</span><br><span class="line">		helper.setText(content, <span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">		FileSystemResource file = <span class="keyword">new</span> FileSystemResource(<span class="keyword">new</span> File(filePath));</span><br><span class="line">		String fileName = filePath.substring(filePath.lastIndexOf(File.separator) + <span class="number">1</span>);</span><br><span class="line">		helper.addAttachment(fileName, file);</span><br><span class="line"></span><br><span class="line">		mailSender.send(message);</span><br><span class="line">		System.out.println(<span class="string">"发送成功"</span>);</span><br><span class="line">	&#125; <span class="keyword">catch</span> (MessagingException e) &#123;</span><br><span class="line">		System.out.println(<span class="string">"发生异常"</span>);</span><br><span class="line">		e.printStackTrace();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试一下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSendAttachmentsMail</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	String filePath = <span class="string">"文件路径"</span>;</span><br><span class="line">	mailserviceImpl.sendAttachmentsMail(toMail, <span class="string">"附件邮件发送"</span>, <span class="string">"附件邮件发送成功，见附件"</span>, filePath);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>报错554 DT:SPM 163</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.mail.MailSendException: Failed messages: com.sun.mail.smtp.SMTPSendFailedException: 554 DT:SPM 163</span><br></pre></td></tr></table></figure>

<p>原因是我把helper的setText方法设置成了HTML格式，所以格式不正确，把第二个参数true去掉即可</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">helper.setText(content, <span class="keyword">true</span>);</span><br></pre></td></tr></table></figure>

<p>还有可能是因为邮件内容或标题是测试<br>其他报错信息请看本文最后</p>
<h4 id="三、发送Html内容的邮件"><a href="#三、发送Html内容的邮件" class="headerlink" title="三、发送Html内容的邮件"></a>三、发送Html内容的邮件</h4><p>和第二个附件的邮件的区别就是</p>
<ul>
<li>test的参数需要设置为true<code>helper.setText(content, true);</code></li>
<li>附件发送的时候设置了<code>helper.addAttachment(fileName, file);</code><br>  Html发送的时候不需要设置这个</li>
<li>setContent的时候，内容必须要是html格式的，不然会报错554 DT:SPM</li>
</ul>
<h5 id="163邮箱退邮件说明"><a href="#163邮箱退邮件说明" class="headerlink" title="163邮箱退邮件说明"></a>163邮箱退邮件说明</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">•421 HL:REP 该IP发送行为异常，存在接收者大量不存在情况，被临时禁止连接。请检查是否有用户发送病毒或者垃圾邮件，并核对发送列表有效性；</span><br><span class="line">•421 HL:ICC 该IP同时并发连接数过大，超过了网易的限制，被临时禁止连接。请检查是否有用户发送病毒或者垃圾邮件，并降低IP并发连接数量；</span><br><span class="line">•421 HL:IFC 该IP短期内发送了大量信件，超过了网易的限制，被临时禁止连接。请检查是否有用户发送病毒或者垃圾邮件，并降低发送频率；</span><br><span class="line">•421 HL:MEP 该IP发送行为异常，存在大量伪造发送域域名行为，被临时禁止连接。请检查是否有用户发送病毒或者垃圾邮件，并使用真实有效的域名发送；</span><br><span class="line">•450 MI:CEL 发送方出现过多的错误指令。请检查发信程序；</span><br><span class="line">•450 MI:DMC 当前连接发送的邮件数量超出限制。请减少每次连接中投递的邮件数量；</span><br><span class="line">•450 MI:CCL 发送方发送超出正常的指令数量。请检查发信程序；</span><br><span class="line">•450 RP:DRC 当前连接发送的收件人数量超出限制。请控制每次连接投递的邮件数量；</span><br><span class="line">•450 RP:CCL 发送方发送超出正常的指令数量。请检查发信程序；</span><br><span class="line">•450 DT:RBL 发信IP位于一个或多个RBL里。请参考http://www.rbls.org/关于RBL的相关信息；</span><br><span class="line">•450 WM:BLI 该IP不在网易允许的发送地址列表里；</span><br><span class="line">•450 WM:BLU 此用户不在网易允许的发信用户列表里；</span><br><span class="line">•451 DT:SPM ,please try again 邮件正文带有垃圾邮件特征或发送环境缺乏规范性，被临时拒收。请保持邮件队列，两分钟后重投邮件。需调整邮件内容或优化发送环境；</span><br><span class="line">•451 Requested mail action not taken: too much fail authentication 登录失败次数过多，被临时禁止登录。请检查密码与帐号验证设置；</span><br><span class="line">•451 RP:CEL 发送方出现过多的错误指令。请检查发信程序；</span><br><span class="line">•451 MI:DMC 当前连接发送的邮件数量超出限制。请控制每次连接中投递的邮件数量；</span><br><span class="line">•451 MI:SFQ 发信人在15分钟内的发信数量超过限制，请控制发信频率；</span><br><span class="line">•451 RP:QRC 发信方短期内累计的收件人数量超过限制，该发件人被临时禁止发信。请降低该用户发信频率；</span><br><span class="line">•451 Requested action aborted: local error in processing 系统暂时出现故障，请稍后再次尝试发送；</span><br><span class="line">•500 Error: bad syntaxU 发送的smtp命令语法有误；</span><br><span class="line">•550 MI:NHD HELO命令不允许为空；</span><br><span class="line">•550 MI:IMF 发信人电子邮件地址不合规范。请参考http://www.rfc-editor.org/关于电子邮件规范的定义；</span><br><span class="line">•550 MI:SPF 发信IP未被发送域的SPF许可。请参考http://www.openspf.org/关于SPF规范的定义；</span><br><span class="line">•550 MI:DMA 该邮件未被发信域的DMARC许可。请参考http://dmarc.org/关于DMARC规范的定义；</span><br><span class="line">•550 MI:STC 发件人当天的连接数量超出了限定数量，当天不再接受该发件人的邮件。请控制连接次数；</span><br><span class="line">•550 RP:FRL 网易邮箱不开放匿名转发（Open relay）；</span><br><span class="line">•550 RP:RCL 群发收件人数量超过了限额，请减少每封邮件的收件人数量；</span><br><span class="line">•550 RP:TRC 发件人当天内累计的收件人数量超过限制，当天不再接受该发件人的邮件。请降低该用户发信频率；</span><br><span class="line">•550 DT:SPM 邮件正文带有很多垃圾邮件特征或发送环境缺乏规范性。需调整邮件内容或优化发送环境；</span><br><span class="line">•550 Invalid User 请求的用户不存在；</span><br><span class="line">•550 User in blacklist 该用户不被允许给网易用户发信；</span><br><span class="line">•550 User suspended 请求的用户处于禁用或者冻结状态；</span><br><span class="line">•550 Requested mail action not taken: too much recipient  群发数量超过了限额；</span><br><span class="line">•552 Illegal Attachment 不允许发送该类型的附件，包括以.uu .pif .scr .mim .hqx .bhx .cmd .vbs .bat .com .vbe .vb .js .wsh等结尾的附件；</span><br><span class="line">•552 Requested mail action aborted: exceeded mailsize limit 发送的信件大小超过了网易邮箱允许接收的最大限制；</span><br><span class="line">•553 Requested action not taken: NULL sender is not allowed 不允许发件人为空，请使用真实发件人发送；</span><br><span class="line">•553 Requested action not taken: Local user only  SMTP类型的机器只允许发信人是本站用户；</span><br><span class="line">•553 Requested action not taken: no smtp MX only  MX类型的机器不允许发信人是本站用户；</span><br><span class="line">•553 authentication is required  SMTP需要身份验证，请检查客户端设置；</span><br><span class="line">•554 DT:SPM 发送的邮件内容包含了未被许可的信息，或被系统识别为垃圾邮件。请检查是否有用户发送病毒或者垃圾邮件；</span><br><span class="line">•554 DT:SUM 信封发件人和信头发件人不匹配；</span><br><span class="line">•554 IP is rejected, smtp auth error limit exceed 该IP验证失败次数过多，被临时禁止连接。请检查验证信息设置；</span><br><span class="line">•554 HL:IHU 发信IP因发送垃圾邮件或存在异常的连接行为，被暂时挂起。请检测发信IP在历史上的发信情况和发信程序是否存在异常；</span><br><span class="line">•554 HL:IPB 该IP不在网易允许的发送地址列表里；</span><br><span class="line">•554 MI:STC 发件人当天内累计邮件数量超过限制，当天不再接受该发件人的投信。请降低发信频率；</span><br><span class="line">•554 MI:SPB 此用户不在网易允许的发信用户列表里；</span><br><span class="line">•554 IP in blacklist 该IP不在网易允许的发送地址列表里。</span><br></pre></td></tr></table></figure>

<p>参考：<br><a href="https://blog.csdn.net/caychen/article/details/82887926" target="_blank" rel="noopener">https://blog.csdn.net/caychen/article/details/82887926</a><br><a href="http://www.ityouknow.com/springboot/2017/05/06/spring-boot-mail.html" target="_blank" rel="noopener">http://www.ityouknow.com/springboot/2017/05/06/spring-boot-mail.html</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://zzuhai.github.io/2019/06/04/spring-boot发送邮件mail/" data-id="cjwhlc967001yawuvcey0zrfi" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/spring-boot/">spring boot</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/JVM/">JVM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MQ/">MQ</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/groovy/">groovy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java/">java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nexus/">nexus</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/socket/">socket</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spring-boot/">spring boot</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spring-cloud/">spring cloud</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据库/">数据库</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据结构/">数据结构</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/缓存/">缓存</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/JVM/" style="font-size: 10px;">JVM</a> <a href="/tags/MQ/" style="font-size: 18px;">MQ</a> <a href="/tags/docker/" style="font-size: 10px;">docker</a> <a href="/tags/groovy/" style="font-size: 10px;">groovy</a> <a href="/tags/java/" style="font-size: 20px;">java</a> <a href="/tags/nexus/" style="font-size: 12px;">nexus</a> <a href="/tags/socket/" style="font-size: 10px;">socket</a> <a href="/tags/spring-boot/" style="font-size: 12px;">spring boot</a> <a href="/tags/spring-cloud/" style="font-size: 16px;">spring cloud</a> <a href="/tags/数据库/" style="font-size: 12px;">数据库</a> <a href="/tags/数据结构/" style="font-size: 14px;">数据结构</a> <a href="/tags/缓存/" style="font-size: 10px;">缓存</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/06/04/熔断器Hystrix配置及使用/">熔断器Hystrix配置及使用</a>
          </li>
        
          <li>
            <a href="/2019/06/04/堆/">堆</a>
          </li>
        
          <li>
            <a href="/2019/06/04/红黑树/">红黑树</a>
          </li>
        
          <li>
            <a href="/2019/06/04/RSA加密使用详解/">RSA加密使用详解</a>
          </li>
        
          <li>
            <a href="/2019/06/04/cron表达式详解/">cron表达式详解</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 zzuhai<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>